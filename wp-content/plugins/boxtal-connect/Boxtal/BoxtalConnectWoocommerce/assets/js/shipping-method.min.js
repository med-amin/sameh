"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e={};e.ratesTable={trigger:"#bw-rates-table",init:function(){var e=document.querySelector(this.trigger),t=this;null!==e&&(t.on("body","click",".bw-add-rate-line",function(e){e.preventDefault();var n=new XMLHttpRequest;n.onreadystatechange=function(e){if(4===n.readyState)if(200===n.status){var r="object"===_typeof(n.response)&&null!==n.response?n.response.data:JSON.parse(n.response).data;t.getTableBody().insertAdjacentHTML("beforeend",r),t.initSelect("#bw-rates-table tbody tr:last-child .bw-tail-select")}else console.log("Error: "+n.status)},n.open("POST",ajaxurl),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json";var r="action=bw_add_rate_line&security="+encodeURIComponent(bwShippingMethodAjaxNonce),o=t.getTableRows();if(null!==o){var i=o[o.length-1],l=[];t.parseNodeChildrenSpecificTypeAction(i,["SELECT","INPUT"],function(e){if("SELECT"===e.tagName){var n=e.getAttribute("name"),r=t.getSelectedOptions(e);r.length>0?r.map(function(e){l.push(n+"="+encodeURIComponent(e.value))}):l.push(n+"=")}else l.push(e.getAttribute("name")+"="+encodeURIComponent(e.value))}),r+="&"+l.join("&")}n.send(r)}),t.on("body","click",".bw-remove-rate-line",function(e){e.preventDefault();var t=document.querySelector(".pricing-item.last_selected");t.remove()}),t.initSelect(".bw-tail-select"),t.submitForm=t.submitForm.bind(t),document.getElementById("mainform").addEventListener("submit",t.submitForm))},getSelectedOptions:function(e,t){for(var n,r=[],o=0,i=e.options.length;o<i;o++)(n=e.options[o]).selected&&(r.push(n),t&&t(n));return r},submitForm:function(e){e.preventDefault();var t=[],n=document.querySelectorAll(".pricing-item");if(n.length>0)for(var r=0;r<n.length;r++){var o=n[r],i={"price-from":o.querySelector("td .price-from").value,"price-to":o.querySelector("td .price-to").value,"weight-from":o.querySelector("td .weight-from").value,"weight-to":o.querySelector("td .weight-to").value,"shipping-class":Array.apply(null,o.querySelector("td .shipping-class").options).filter(function(e){return e.selected}).map(function(e){return e.value}),"parcel-point-network":Array.apply(null,o.querySelector("td .parcel-point-network").options).filter(function(e){return e.selected}).map(function(e){return e.value}),pricing:o.querySelector("td .pricing").value,"flat-rate":o.querySelector("td .flat-rate").value};t.push(i)}var l=document.querySelectorAll(".pricing-item input, .pricing-item select");if(l.length>0)for(var a=0;a<l.length;a++){l[a].disabled=!0}var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","pricing-items"),c.value=JSON.stringify(t);var u=document.createElement("input");return u.setAttribute("type","hidden"),u.setAttribute("name","save"),u.value=document.querySelector('button[type="submit"]').value,document.querySelector(this.trigger).appendChild(c),document.querySelector(this.trigger).appendChild(u),document.getElementById("mainform").removeEventListener("submit",this.submitForm),document.getElementById("mainform").submit(),!0},initSelect:function(e){for(var t=this,n=tail.select(e,{locale:bwLocale,multiShowCount:!1,multiSelectAll:!0,cbComplete:function(e){var n=t.getPlaceholderText(this),r=e.querySelector(".label-inner");null!==r&&(r.innerHTML=n)}}),r=function(e){var r=n[e];r.on("close",function(){t.refreshSelectText(this)}),r.e.name.indexOf('["pricing"]')>-1&&r.on("change",function(e,t){var n=/pricing-items\[(\d+)\]\["pricing"\]/g.exec(r.e.name);if(null!==n){var o=n[1],i=document.getElementById("flat-rate-"+o);null!==i&&("rate"===e.key?(i.removeAttribute("disabled"),""===i.value&&(i.value=0)):i.setAttribute("disabled","disabled"))}})},o=0;o<n.length;o++)r(o)},getPlaceholderText:function(e){if(e.options.length>0){for(var t=[],n=0;n<e.options.length;n++){var r=e.options[n];!0===r.selected&&t.push(r.value)}return t.length>0?t.length===e.options.length?tail.select.strings[bwLocale].all:t.join(", "):tail.select.strings[bwLocale].none}return tail.select.strings[bwLocale].emptySearch},refreshSelectText:function(e){var t=this.getPlaceholderText(e);e.config("placeholder",t)},getTableBody:function(){var e=document.querySelector(this.trigger).querySelector("tbody");return null===e?null:e},getTableRows:function(){var e=this.getTableBody();return null===e?null:0===e.childElementCount?null:e.children},parseNodeChildrenSpecificTypeAction:function(e,t,n){if(e.hasChildNodes())for(var r=e.childNodes,o=0;o<r.length;o++){var i=r[o];-1!==t.indexOf(i.tagName)&&n(i),this.parseNodeChildrenSpecificTypeAction(i,t,n)}return e},on:function(e,t,n,r){var o=document.querySelector(e);o.addEventListener(t,function(e){for(var t=o.querySelectorAll(n),i=e.target,l=0,a=t.length;l<a;l++)for(var c=i,u=t[l];c&&c!==o;){if(c===u)return r.call(u,e);c=c.parentNode}})}},document.addEventListener("DOMContentLoaded",function(){e.ratesTable.init()})}();